#!/usr/bin/env sh
#
# a simple dmenu mocp script to select song from playlist
# by zordsdavini, 2016
#
###

# TODO: I don't know why grep gives in DOS format – removed it with `tr`

# check mocp is running
rez=$(mocp -i | wc -l)
if [ $rez -lt 1 ] ; then
  mocp -S 
fi

# format dmenu
# DMENU="dmenu -i -p → -fn Andika-8 -nb #15181a -nf #00ff00 -sb #079822 -sf #fff -h 24 -l 50"

DMENU() {
	dmenu -i -p → -fn "Andika-8" -nb "#15181a" -nf "#00ff00" -sb "#079822" -sf "#fff" -h "24" -l "$1"
}

lines=$(grep -u -E "^[^#]" ~/.moc/playlist.m3u | tr -d '\015' | wc -l)

# select songs from existing playlist (generated by MOC)
choice=$(grep -u -E "^[^#]" ~/.moc/playlist.m3u | tr -d '\015' | DMENU "$lines")

# play selected song. If error it will do nothing
if [ -n "$choice" ]; then
	mocp -l "$choice"
fi
